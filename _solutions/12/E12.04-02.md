---
title:       Exercise 12.4-2
published:   2025-11-16 10:00
modified:    2025-11-16 10:00
keywords:    "binary search tree, tree height, average depth, asymptotic bounds"
description: "Describe a binary search tree on n nodes such that the average depth of a node in the tree is Θ(lg n) but the height of the tree is ω(lg n). Give an asymptotic upper bound on the height of an n-node binary search tree in which the average depth of a node is Θ(lg n)."
---

> Describe a binary search tree on $$n$$ nodes such that the average depth of a node in the tree is $$\Theta(\lg n)$$ but the height of the tree is $$\omega(\lg n)$$. Give an asymptotic upper bound on the height of an $$n$$-node binary search tree in which the average depth of a node is $$\Theta(\lg n)$$.

### Part 1: Tree with Average Depth $$\Theta(\lg n)$$ but Height $$\omega(\lg n)$$

We can construct such a tree by combining a complete binary tree with a long path.

**Construction:** Start with a complete binary tree of $$n - \sqrt{n}$$ nodes (height $$\Theta(\lg n)$$), then attach a path of $$\sqrt{n}$$ nodes to one of the leaves.

For example, with $$n = 16$$:
- Complete tree of 12 nodes (height 3)
- Path of 4 nodes attached to a leaf (increasing height to 7)

```
          8
        /   \
       4     12
      / \    / \
     2   6  10 14
    / \ / \ / \ / \
   1  3 5 7 9 11 13 15
                    \
                    16
```

**Average depth analysis:**

- The complete tree has $$n - \sqrt{n}$$ nodes
- Each node in the complete tree has depth $$O(\lg n)$$
- The path adds $$\sqrt{n}$$ nodes
- Nodes on the path have depths from $$\lg n$$ to $$\lg n + \sqrt{n}$$

Total depth sum:

$$\begin{align*}
\sum_{\text{all nodes}} \text{depth} &= \sum_{\text{complete tree}} O(\lg n) + \sum_{\text{path}} O(\lg n + \sqrt{n}) \\
&= (n - \sqrt{n}) \cdot O(\lg n) + \sqrt{n} \cdot O(\lg n + \sqrt{n}) \\
&= O(n \lg n) + O(\sqrt{n} \cdot \sqrt{n}) \\
&= O(n \lg n) + O(n) \\
&= O(n \lg n)
\end{align*}$$

Average depth: $$\frac{O(n \lg n)}{n} = O(\lg n) = \Theta(\lg n)$$ ✓

**Height:** $$h = \lg(n - \sqrt{n}) + \sqrt{n} = \Theta(\sqrt{n})$$

Since $$\sqrt{n} = \omega(\lg n)$$, we have $$h = \omega(\lg n)$$ ✓

### Part 2: Upper Bound on Height Given Average Depth $$\Theta(\lg n)$$

**Claim:** If the average depth is $$\Theta(\lg n)$$, then the height is $$O(n)$$.

**Proof:** Let $$h$$ denote the height of the tree.

The average depth is:

$$\frac{1}{n} \sum_{i=1}^{n} d_i$$

where $$d_i$$ is the depth of node $$i$$.

Since each node has depth at most $$h$$:

$$\sum_{i=1}^{n} d_i \le n \cdot h$$

If the average depth is $$\Theta(\lg n)$$:

$$\frac{1}{n} \sum_{i=1}^{n} d_i = \Theta(\lg n)$$

Therefore:

$$n \cdot \Theta(\lg n) \ge \sum_{i=1}^{n} d_i$$

But we can have at most one node at depth $$h$$, and the sum of depths is at least the depth of this deepest node:

$$h \le \sum_{i=1}^{n} d_i = n \cdot \Theta(\lg n) = \Theta(n \lg n)$$

Wait, this gives $$h = O(n \lg n)$$, which is too weak.

Let me reconsider. Actually, a tighter bound:

**Better bound:** The height is $$O(\sqrt{n \lg n})$$.

Here is why: If we have a path of length $$k$$ hanging off a balanced tree, the path contributes $$\Theta(k^2)$$ to the total depth sum (nodes at depths $$d, d+1, \ldots, d+k$$ contribute $$\sum_{i=0}^{k} i = \Theta(k^2)$$).

For the average depth to remain $$\Theta(\lg n)$$, we need:

$$\frac{k^2 + \text{other depths}}{n} = \Theta(\lg n)$$

This implies $$k^2 = O(n \lg n)$$, so $$k = O(\sqrt{n \lg n})$$.

Therefore, the maximum height is $$h = O(\sqrt{n \lg n})$$.

{% include ads.html %}

{% capture note %}
The construction in Part 1 shows that we can have height significantly larger than $$\lg n$$ while maintaining average depth $$\Theta(\lg n)$$. This is because:

1. Most nodes can be in a balanced subtree (low depth)
2. A relatively small number of nodes can be in a long path (high depth)
3. The path nodes do not dominate the average because there are few of them

This illustrates that **average depth** and **height** measure different aspects of tree shape. Average depth reflects the typical case, while height reflects the worst case.
{% endcapture %}
{% include aside.html title='Average vs worst case tree depth' %}

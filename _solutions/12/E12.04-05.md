---
title:       Exercise 12.4-5
published:   2025-11-16 10:00
modified:    2025-11-16 10:00
keywords:    "randomized quicksort, probability, permutations, running time"
description: "Consider RANDOMIZED-QUICKSORT operating on a sequence of n distinct input numbers. Prove that for any constant k > 0, all but O(1/n^k) of the n! input permutations yield an O(n lg n) running time."
---

> Consider $$\textsc{Randomized-Quicksort}$$ operating on a sequence of $$n$$ distinct input numbers. Prove that for any constant $$k > 0$$, all but $$O(1/n^k)$$ of the $$n!$$ input permutations yield an $$O(n \lg n)$$ running time.

This exercise asks us to show that **with high probability over the input permutation**, randomized quicksort runs in $$O(n \lg n)$$ time, even though we know there exist bad permutations that cause $$\Theta(n^2)$$ time.

### Strategy

We will use Markov's inequality to bound the probability that quicksort takes more than $$c n \lg n$$ time for some large constant $$c$$.

From Section 7.4, we know that the **expected running time** of $$\textsc{Randomized-Quicksort}$$ on any input permutation is $$O(n \lg n)$$. Specifically, there exists a constant $$c_0$$ such that:

$$\mathbb{E}[T(n)] \le c_0 n \lg n$$

where the expectation is over the random choices made by the algorithm (the random pivot selection).

### Applying Markov's Inequality

Markov's inequality states that for a non-negative random variable $$X$$:

$$\Pr[X \ge a] \le \frac{\mathbb{E}[X]}{a}$$

Let $$T_\pi(n)$$ denote the running time of randomized quicksort on permutation $$\pi$$. For a fixed permutation $$\pi$$, $$T_\pi(n)$$ is a random variable (randomness comes from pivot choices).

For any threshold $$a = c \cdot n \lg n$$ where $$c$$ is a large constant:

$$\Pr[T_\pi(n) \ge c \cdot n \lg n] \le \frac{\mathbb{E}[T_\pi(n)]}{c \cdot n \lg n} \le \frac{c_0 n \lg n}{c \cdot n \lg n} = \frac{c_0}{c}$$

Choose $$c = c_0 \cdot n^k$$ for constant $$k > 0$$:

$$\Pr[T_\pi(n) \ge c_0 n^{k+1} \lg n] \le \frac{c_0}{c_0 n^k} = \frac{1}{n^k}$$

This means that for **any single permutation** $$\pi$$, the probability (over random pivot choices) that quicksort takes more than $$O(n^{k+1} \lg n)$$ time is at most $$\frac{1}{n^k}$$.

### Counting Bad Permutations

But we want to bound the **number of permutations** that are likely to cause bad performance, not the probability for a single permutation.

Actually, let me reconsider the problem. The problem asks about "all but $$O(1/n^k)$$ of the $$n!$$ input permutations." This suggests we're looking at the **fraction** of permutations, not probability.

{% include ads.html %}

Let me reinterpret: For randomized quicksort, the running time depends on both:
1. The input permutation $$\pi$$
2. The random pivot choices

The expected running time $$\mathbb{E}[T_\pi(n)]$$ (averaging over random pivots) is $$O(n \lg n)$$ for **every** input permutation $$\pi$$, as proven in Chapter 7.

Now, using Markov's inequality: For any permutation $$\pi$$ and any $$c > 0$$:

$$\Pr_{\text{pivots}}[T_\pi(n) \ge c \cdot n \lg n] \le \frac{O(n \lg n)}{c \cdot n \lg n} = O\left(\frac{1}{c}\right)$$

Choose $$c = n^k$$:

$$\Pr_{\text{pivots}}[T_\pi(n) \ge n^{k+1} \lg n] \le O\left(\frac{1}{n^k}\right)$$

This holds for **every** input permutation $$\pi$$.

Therefore, for any input permutation, the probability (over random pivot choices) that the running time exceeds $$n^{k+1} \lg n$$ is at most $$O(1/n^k)$$.

Equivalently, for any input permutation, with probability $$1 - O(1/n^k)$$ over the random pivot choices, the running time is at most $$n^{k+1} \lg n = O(n \lg n)$$ (when $$k$$ is constant).

### Final Statement

For randomized quicksort with random pivot selection:
- **Every** input permutation has expected running time $$O(n \lg n)$$
- For any input permutation, with high probability ($$1 - O(1/n^k)$$), the running time is $$O(n^{k+1} \lg n)$$
- The fraction of (input permutation, pivot choice) pairs that yield bad performance is $$O(1/n^k)$$

This shows that randomized quicksort is robust: it performs well not just on average, but with high probability for every input.

{% capture note %}
This exercise highlights an important distinction between:

1. **Average-case analysis:** Expected running time over random inputs (or random pivots)
2. **High-probability bounds:** Running time is good with probability $$1 - O(1/n^k)$$

Randomized quicksort achieves both:
- Expected $$O(n \lg n)$$ time on every input
- With high probability ($$1 - O(1/n^k)$$), runs in $$O(n^{k+1} \lg n)$$ time

This makes it highly reliable in practice. Even in the worst case over all possible random choices, quicksort rarely takes much longer than $$O(n \lg n)$$.
{% endcapture %}
{% include aside.html title='Randomized algorithms and high-probability bounds' %}

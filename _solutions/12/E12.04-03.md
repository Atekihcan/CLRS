---
title:       Exercise 12.4-3
published:   2025-11-16 10:00
modified:    2025-11-16 10:00
keywords:    "binary search tree, random tree, probability, combinatorics"
description: "Show that the notion of a randomly chosen binary search tree on n keys, where each binary search tree of n keys is equally likely to be chosen, is different from the notion of a randomly built binary search tree given in this section. (Hint: List the possibilities when n = 3.)"
---

> Show that the notion of a randomly chosen binary search tree on $$n$$ keys, where each binary search tree of $$n$$ keys is equally likely to be chosen, is different from the notion of a randomly built binary search tree given in this section. (*Hint:* List the possibilities when $$n = 3$$.)

These two notions of randomness are fundamentally different. Let's examine the case $$n = 3$$ with keys $$\{1, 2, 3\}$$.

### Randomly Chosen BST (Each Tree Equally Likely)

First, let's enumerate all possible BST shapes with 3 nodes:

**Shape 1: Linear chain (right)**
```
1
 \
  2
   \
    3
```

**Shape 2: Linear chain (left)**
```
    3
   /
  2
 /
1
```

**Shape 3: Balanced (root = 2)**
```
  2
 / \
1   3
```

**Shape 4: Right-leaning (root = 1)**
```
1
 \
  3
 /
2
```

**Shape 5: Left-leaning (root = 3)**
```
  3
 /
1
 \
  2
```

There are exactly **5 distinct BSTs** with keys $$\{1, 2, 3\}$$.

In the "randomly chosen" model, each of these 5 trees has probability $$\frac{1}{5}$$.

### Randomly Built BST (Random Insertion Order)

In this model, we insert the keys in a random order, where each of the $$3! = 6$$ permutations is equally likely.

Let's trace through each insertion order:

1. **Insert order (1, 2, 3):** Produces Shape 1 (right chain)
2. **Insert order (1, 3, 2):** Produces Shape 4 (root = 1, then 3, then 2 goes left of 3)
3. **Insert order (2, 1, 3):** Produces Shape 3 (balanced, root = 2)
4. **Insert order (2, 3, 1):** Produces Shape 3 (balanced, root = 2)
5. **Insert order (3, 1, 2):** Produces Shape 5 (root = 3, then 1, then 2 goes right of 1)
6. **Insert order (3, 2, 1):** Produces Shape 2 (left chain)

**Probabilities in randomly built model:**

- Shape 1 (right chain): appears 1 time, probability = $$\frac{1}{6}$$
- Shape 2 (left chain): appears 1 time, probability = $$\frac{1}{6}$$
- Shape 3 (balanced, root = 2): appears 2 times, probability = $$\frac{2}{6} = \frac{1}{3}$$
- Shape 4 (root = 1, right-leaning): appears 1 time, probability = $$\frac{1}{6}$$
- Shape 5 (root = 3, left-leaning): appears 1 time, probability = $$\frac{1}{6}$$

### Comparison

| Tree Shape | Randomly Chosen | Randomly Built |
|------------|----------------|----------------|
| Shape 1 (right chain) | $$\frac{1}{5} = 0.2$$ | $$\frac{1}{6} \approx 0.167$$ |
| Shape 2 (left chain) | $$\frac{1}{5} = 0.2$$ | $$\frac{1}{6} \approx 0.167$$ |
| Shape 3 (balanced) | $$\frac{1}{5} = 0.2$$ | $$\frac{1}{3} \approx 0.333$$ |
| Shape 4 (right-leaning) | $$\frac{1}{5} = 0.2$$ | $$\frac{1}{6} \approx 0.167$$ |
| Shape 5 (left-leaning) | $$\frac{1}{5} = 0.2$$ | $$\frac{1}{6} \approx 0.167$$ |

The probability distributions are **different**! In particular, the balanced tree (Shape 3) is more likely in the randomly built model ($$\frac{1}{3}$$ vs $$\frac{1}{5}$$).

### Why the Difference?

In the "randomly chosen" model, all trees are equally likely regardless of how they arise.

In the "randomly built" model, the probability of a tree depends on **how many insertion orders produce it**. Some trees (like the balanced tree) can be produced by multiple insertion orders, making them more likely.

Specifically, the balanced tree with root 2 can be produced by:
- Inserting 2 first (2 ways to insert the remaining elements: (2,1,3) or (2,3,1))

This gives it higher probability than trees that can only be produced by a single insertion order.

### General Observation

For larger $$n$$, the number of possible BST shapes is the $$n$$-th Catalan number $$C_n = \frac{1}{n+1}\binom{2n}{n}$$, which grows exponentially. The "randomly chosen" model assigns probability $$\frac{1}{C_n}$$ to each shape.

The "randomly built" model assigns probabilities based on the number of permutations producing each tree, which is not uniform across trees. Balanced trees tend to be more likely than highly skewed trees.

{% capture note %}
The randomly built model (used in Theorem 12.4) is more realistic for practical applications where elements arrive in random order. It also has better analytical properties, as we can analyze it using the rank of the root.

The randomly chosen model is mathematically simpler (uniform distribution over trees) but doesn't correspond to any natural process of tree construction. It's mainly used for theoretical analysis in combinatorics.
{% endcapture %}
{% include aside.html title='Which random model to use?' %}

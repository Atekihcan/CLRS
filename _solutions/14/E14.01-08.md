---
title:       Exercise 14.1-8
published:   2025-11-16 00:00
modified:    2025-11-16 00:00
keywords:    "chords on circle, intersections, order-statistic tree, sweep line, computational geometry"
description: "Consider n chords on a circle, each defined by its endpoints. Describe an O(n lg n)-time algorithm to determine the number of pairs of chords that intersect inside the circle."
---

> Consider $$n$$ chords on a circle, each defined by its endpoints. Describe an $$O(n \lg n)$$-time algorithm to determine the number of pairs of chords that intersect inside the circle. (For example, if the $$n$$ chords are all diameters that meet at the center, then the correct answer is $$\binom{n}{2}$$.) Assume that no two chords share an endpoint.

Two chords intersect inside a circle if and only if their endpoints alternate around the circle. That is, if we label a chord's endpoints as $$a$$ and $$b$$, and another chord's endpoints as $$c$$ and $$d$$, the chords intersect if and only if the circular order is either $$a, c, b, d$$ or $$a, d, b, c$$.

{% include ads.html %}

### Key Observation

Label the points around the circle from 1 to $$2n$$ in clockwise order. For each chord, let $$(a_i, b_i)$$ denote its two endpoints where $$a_i < b_i$$. Two chords $$(a_i, b_i)$$ and $$(a_j, b_j)$$ intersect if and only if:

$$a_i < a_j < b_i < b_j \quad \text{or} \quad a_j < a_i < b_j < b_i$$

This is equivalent to saying their intervals $$[a_i, b_i]$$ and $$[a_j, b_j]$$ "nest" but don't contain each other.

### Algorithm

We can reduce this problem to counting inversions. Process the $$2n$$ points in clockwise order. When we encounter a point:

1. If it's the first endpoint of a chord (the one with smaller label), insert it into an order-statistic tree
2. If it's the second endpoint of a chord, count how many chords with first endpoints already seen have their second endpoints not yet seen

Here's a more precise algorithm:

{% capture code %}
Count-Chord-Intersections(chords)
    // Assume chords[i] = (a[i], b[i]) with a[i] < b[i]
    count = 0
    T = empty order-statistic tree

    // Create events: (position, type, chord_id)
    events = []
    for i = 1 to n
        append (a[i], "start", i) to events
        append (b[i], "end", i) to events

    // Sort events by position
    sort events

    for each event (pos, type, i) in events
        if type == "start"
            Insert(T, i)
        else  // type == "end"
            r = OS-Rank(T, find_node(T, i))
            count = count + (T.root.size - r)
            Delete(T, find_node(T, i))

    return count
{% endcapture %}
{% include clrs_code.html title="Count-Chord-Intersections(chords)" %}

### How It Works

When we process the second endpoint $$b_i$$ of chord $$i$$, all chords whose first endpoints we've seen but whose second endpoints we haven't seen yet are still in the tree. The chord $$i$$ intersects with any of these chords whose first endpoint comes after $$a_i$$ in clockwise order.

If chord $$i$$ has rank $$r$$ in the tree, then there are $$(size - r)$$ chords with first endpoints larger than $$a_i$$. Each of these chords must intersect chord $$i$$ because:
- Their first endpoint $$a_j > a_i$$ (since rank of $$i$$ is $$r$$)
- Their second endpoint $$b_j > b_i$$ (since we haven't seen it yet, and we're at position $$b_i$$)
- We have $$a_i < a_j < b_i < b_j$$, which means the chords intersect

### Time Complexity

Sorting the $$2n$$ events takes $$O(n \lg n)$$ time. We process $$2n$$ events, and each event involves at most one tree operation (insert, delete, or rank query), each taking $$O(\lg n)$$ time. Total time: $$O(n \lg n)$$.

### Example

Consider 3 chords with endpoints: $$(1,4)$$, $$(2,5)$$, $$(3,6)$$.
- Process point 1: Insert chord 1
- Process point 2: Insert chord 2
- Process point 3: Insert chord 3
- Process point 4: Chord 1 has rank 1, count = $$0 + (3-1) = 2$$ (intersects chords 2,3)
- Process point 5: Chord 2 has rank 1, count = $$2 + (2-1) = 3$$ (intersects chord 3)
- Process point 6: Chord 3 has rank 1, count = $$3 + (1-1) = 3$$

Total: 3 intersections, which is $$\binom{3}{2}$$, correct for this configuration.

---
title:       Exercise 5.3-1
published:   2025-01-13 00:00
modified:    2025-01-13 00:00
keywords:    "randomized algorithms, loop invariant, random permutation"
description: "Rewrite the procedure RANDOMIZE-IN-PLACE so that its associated loop invariant applies to a nonempty subarray prior to the first iteration, and modify the proof of Lemma 5.5 for your procedure."
---

> Professor Marceau objects to the loop invariant used in the proof of Lemma 5.5. He questions whether it is true prior to the first iteration. He reasons that we could just as easily declare that an empty subarray contains no 0-permutations. Therefore, the probability that an empty subarray contains a 0-permutation should be 0, thus invalidating the loop invariant prior to the first iteration. Rewrite the procedure $$\textsc{Randomize-In-Place}$$ so that its associated loop invariant applies to a nonempty subarray prior to the first iteration, and modify the proof of Lemma 5.5 for your procedure.

Professor Marceau raises an interesting philosophical point about empty sets and permutations. While the original proof is mathematically sound (an empty subarray vacuously satisfies any property), we can address his concern by modifying the algorithm to start with a nonempty subarray.

Here's a revised version of $$\textsc{Randomize-In-Place}$$ that starts by placing a random element in position 1:

{% capture code %}
n = A.length
swap A[1] with A[Random(1, n)]
for i = 2 to n
    swap A[i] with A[Random(i, n)]
{% endcapture %}
{% include clrs_code.html title="Randomize-In-Place(A)" %}

The key difference is that we handle the first element separately (line 2) before entering the loop. This ensures that before the loop starts (when $$i = 2$$), we already have a nonempty subarray $$A$$[1..1] containing exactly one element.

The modified loop invariant states: Just prior to the $$i$$th iteration of the **for** loop of lines 3â€“4, for each possible $$(i - 1)$$-permutation of the $$n$$ elements, the subarray $$A$$[1..$$i$$ - 1] contains this $$(i - 1)$$-permutation with probability $$(n - i + 1)!  / n!$$.

{% include ads.html %}

We can now prove correctness using this invariant.

**Initialization:** Consider the situation just before the first loop iteration, when $$i = 2$$. After line 2, each of the $$n$$ elements is equally likely to be in position $$A$$[1]. The subarray $$A$$[1..1] is a 1-permutation, and there are $$n$$ possible 1-permutations. Each appears with probability $$1/n = (n - 1)! / n!$$, satisfying the loop invariant.

**Maintenance:** The maintenance step follows the same argument as the original proof. Assume the invariant holds for $$i - 1$$. We show it holds for $$i$$ by considering a particular $$i$$-permutation. This $$i$$-permutation consists of an $$(i - 1)$$-permutation followed by element $$x_i$$. Let $$E_1$$ be the event that the $$(i - 1)$$-permutation appears in $$A$$[1..$$i$$ - 1], which has probability $$(n - i + 1)! / n!$$ by the loop invariant. Let $$E_2$$ be the event that line 4 puts $$x_i$$ in position $$A$$[$$i$$], which has probability $$1/(n - i + 1)$$ since we choose randomly from the $$n - i + 1$$ remaining positions.

Since $$E_1$$ and $$E_2$$ are independent:

$$\begin{align*}
\Pr\{E_2 \cap E_1\} &= \Pr\{E_2 \mid E_1\} \Pr\{E_1\} \\
&= \frac{1}{n - i + 1} \cdot \frac{(n - i + 1)!}{n!} \\
&= \frac{(n - i)!}{n!}
\end{align*}$$

This maintains the loop invariant for iteration $$i$$.

**Termination:** At termination, $$i = n + 1$$, and the subarray $$A$$[1..$$n$$] contains a given $$n$$-permutation with probability $$(n - (n + 1) + 1)! / n! = 0! / n! = 1/n!$$. Thus, the procedure produces a uniform random permutation.

{% capture note %}
The original proof's handling of the empty subarray as a 0-permutation is actually a standard mathematical convention. A 0-permutation is indeed the empty sequence, and there is exactly one such sequence. However, Professor Marceau's alternative formulation is equally valid and may be more intuitive for those uncomfortable with reasoning about empty sets.
{% endcapture %}
{% include aside.html title='Mathematical Conventions' %}

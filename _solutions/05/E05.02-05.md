---
title:       Exercise 5.2-5
published:   2025-01-13 00:00
modified:    2025-01-13 00:00
keywords:    "inversions, indicator random variables, expected value, permutations, sorting"
description: "Let A[1..n] be an array of n distinct numbers. If i < j and A[i] > A[j], then the pair (i, j) is called an inversion of A. Suppose that the elements of A form a uniform random permutation of {1, 2, ..., n}. Use indicator random variables to compute the expected number of inversions."
---

>Let $$A[1..n]$$ be an array of $$n$$ distinct numbers. If $$i < j$$ and $$A[i] > A[j]$$, then the pair $$(i, j)$$ is called an **_inversion_** of $$A$$. (See [Problem 2-4]({% link _solutions/02/P02-04.md %}) for more on inversions.) Suppose that the elements of $$A$$ form a uniform random permutation of $$\{1, 2, \ldots, n\}$$. Use indicator random variables to compute the expected number of inversions.

An inversion is a pair of elements that are "out of order" with respect to their positions. For example, in the array $$[3, 1, 4, 2]$$, the pairs $$(1,2)$$, $$(1,4)$$, and $$(3,4)$$ are inversions because $$A[1] > A[2]$$, $$A[1] > A[4]$$, and $$A[3] > A[4]$$ respectively.

### Setting Up Indicator Random Variables

For each pair of indices $$(i, j)$$ where $$1 \leq i < j \leq n$$, we define an indicator random variable:

$$X_{ij} = \begin{cases}
1 & \text{if } (i, j) \text{ is an inversion, i.e., } A[i] > A[j] \\
0 & \text{otherwise}
\end{cases}$$

The total number of inversions in the array is:

$$X = \sum_{1 \leq i < j \leq n} X_{ij}$$

By linearity of expectation:

$$E[X] = E\left[\sum_{1 \leq i < j \leq n} X_{ij}\right] = \sum_{1 \leq i < j \leq n} E[X_{ij}]$$

### Computing the Probability

By Lemma 5.1, we have:

$$E[X_{ij}] = \Pr\{X_{ij} = 1\} = \Pr\{A[i] > A[j]\}$$

Since the array contains a uniform random permutation of $$\{1, 2, \ldots, n\}$$, for any two positions $$i$$ and $$j$$, the values $$A[i]$$ and $$A[j]$$ are two distinct random values from this set. These two values are equally likely to appear in either order. Therefore:

$$\Pr\{A[i] > A[j]\} = \frac{1}{2}$$

This gives us:

$$E[X_{ij}] = \frac{1}{2}$$

### Counting the Pairs

The number of pairs $$(i, j)$$ with $$i < j$$ is:

$$\binom{n}{2} = \frac{n(n-1)}{2}$$

### Final Calculation

$$\begin{align*}
E[X] &= \sum_{1 \leq i < j \leq n} E[X_{ij}] \\
&= \sum_{1 \leq i < j \leq n} \frac{1}{2} \\
&= \binom{n}{2} \cdot \frac{1}{2} \\
&= \frac{n(n-1)}{2} \cdot \frac{1}{2} \\
&= \frac{n(n-1)}{4}
\end{align*}$$

{% capture note %}
This result has important implications for sorting algorithms. Since a random array has about $$n^2/4$$ inversions on average, any comparison-based sorting algorithm that removes one inversion per comparison needs at least this many comparisons on average.

For $$n = 100$$, the expected number of inversions is $$\frac{100 \cdot 99}{4} = 2{,}475$$. This is why insertion sort, which removes one inversion per swap, takes $$\Theta(n^2)$$ time on average for random input.
{% endcapture %}
{% include aside.html title='Why Sorting is Hard' %}

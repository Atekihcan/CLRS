---
title:       Exercise 8.2-4
published:   2025-11-16 20:15
modified:    2025-11-16 20:15
keywords:    "counting sort, range query, preprocessing, linear time"
description: "Describe an algorithm that, given n integers in the range 0 to k, preprocesses its input and then answers any query about how many of the n integers fall into a range [a..b] in O(1) time."
---

> Describe an algorithm that, given $$n$$ integers in the range 0 to $$k$$, preprocesses its input and then answers any query about how many of the $$n$$ integers fall into a range $$[a \mathinner{.\,.} b]$$ in $$O(1)$$ time. Your algorithm should use $$\Theta(n + k)$$ preprocessing time.

The key insight is to use the counting array from counting sort, but keep it in its cumulative form.

Think of a simpler problem first: how many numbers are $$\leq b$$? If we have a cumulative count array, this is just one lookup. Similarly, how many are $$\leq a - 1$$? Another lookup. The difference gives us the count in range $$[a \mathinner{.\,.} b]$$.

### Preprocessing ($$\Theta(n + k)$$ time):

```python
def preprocess(A, k):
    # Initialize count array
    C = [0] * (k + 1)

    # Count occurrences (Θ(n) time)
    for x in A:
        C[x] += 1

    # Compute cumulative sum (Θ(k) time)
    for i in range(1, k + 1):
        C[i] = C[i] + C[i - 1]

    return C
```

After preprocessing, $$C[i]$$ contains the number of elements in $$A$$ with value $$\leq i$$.

### Query ($$O(1)$$ time):

```python
def range_query(C, a, b):
    if a == 0:
        return C[b]
    else:
        return C[b] - C[a - 1]
```

The number of elements in range $$[a \mathinner{.\,.} b]$$ equals the number of elements $$\leq b$$ minus the number of elements $$\leq a - 1$$.

### Example:

Suppose $$A = [2, 5, 3, 0, 2, 3, 0, 3]$$ with $$k = 5$$.

After counting: $$C = [2, 0, 2, 3, 0, 1]$$

After cumulative sum: $$C = [2, 2, 4, 7, 7, 8]$$

Query $$[2 \mathinner{.\,.} 3]$$: $$C[3] - C[1] = 7 - 2 = 5$$

Indeed, values 2, 2, 3, 3, 3 are in range $$[2 \mathinner{.\,.} 3]$$.

This technique is used in practice for histogram-based queries and is a foundation for more complex data structures like segment trees.
